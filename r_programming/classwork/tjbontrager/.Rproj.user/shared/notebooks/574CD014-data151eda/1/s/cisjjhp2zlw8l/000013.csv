"0","# library(tidyverse)"
"0","# library(janitor)"
"0","# library(glue)"
"0","# "
"0","# raw_df <- read_csv(here::here(""2020"", ""2020-03-10"", ""all_schools.csv"")) %>% "
"0","#   janitor::clean_names()"
"0","# "
"0","# raw_cost <- raw_df %>% "
"0","#   select(name = institution_name, state = state_abbreviation_hd2017,"
"0","#          contains(""total_price_for_in_state_students"")) %>% "
"0","#   pivot_longer(names_to = ""category"", values_to = ""total_price"", total_price_for_in_state_students_living_on_campus_2007_08_drvic2007:total_price_for_in_state_students_living_off_campus_not_with_family_2020_21_drvic2020) %>% "
"0","#   mutate(year = as.double(str_sub(category, -4)),"
"0","#          category = str_remove(category, ""total_price_for_in_state_students_living_""),"
"0","#          campus = if_else(str_detect(category, ""on_campus""), ""On Campus"", ""Off Campus"")) %>% "
"0","#   filter(!is.na(total_price)) %>% "
"0","#   select(-category)"
"0","# "
"0","# net_cost <- raw_df %>% "
"0","#   select(name = institution_name, state = state_abbreviation_hd2017,"
"0","#          starts_with(""average_net_price_income"")) %>% "
"0","#   pivot_longer(names_to = ""category"", values_to = ""net_cost"", "
"0","#                average_net_price_income_0_30_000_students_awarded_title_iv_federal_financial_aid_2016_17_sfa1617:average_net_price_income_over_110_000_students_receiving_title_iv_federal_financial_aid_2008_09_sfa0809) %>% "
"0","#   filter(!is.na(net_cost)) %>% "
"0","#   mutate(year = str_sub(category, -4, -3),"
"0","#          year = glue::glue(""20{year}""),"
"0","#          year = as.double(year),"
"0","#          category = str_remove(category, ""average_net_price_income_""),"
"0","#          category = str_remove(category, str_sub(category, -16)),"
"0","#          income_lvl = str_remove(category, ""_students_awarded_title_iv_federal_financial_aid""),"
"0","#          income_lvl = case_when("
"0","#            str_detect(income_lvl, ""30_000"") ~ ""0 to 30,000"","
"0","#            str_detect(income_lvl, ""30_001"") ~ ""30,001 to 48,000"","
"0","#            str_detect(income_lvl, ""48_001"") ~ ""48_001 to 75,000"","
"0","#            str_detect(income_lvl, ""75_001"") ~ ""75,001 to 110,000"","
"0","#            str_detect(income_lvl, ""110_000"") ~ ""Over 110,000"","
"0","#            TRUE ~ NA_character_)"
"0","#          ) %>% "
"0","#   select(-category)"
"0","# "
"0","# full_dataset <- left_join(raw_cost, net_cost, by = c(""name"", ""year"", ""state"")) %>% "
"0","#   filter(!is.na(net_cost))"
"0","# "
"0","# full_dataset %>% "
"0","#   write_csv(here::here(""2020"", ""2020-03-10"", ""tuition_income.csv""))"
"0",""
"0","#code found on tidytuesday github by user jthomasmock https://github.com/jthomasmock"
